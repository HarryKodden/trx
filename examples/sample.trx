INCLUDE init.trx;
INCLUDE json_test.trx;

CONSTANT PI 3.14159;
CONSTANT APP_NAME "TRX Interpreter";

TYPE ADDRESS {
    STREET CHAR(64);
    ZIP INTEGER;
}

TYPE EMPLOYEE {
    ID INTEGER;
    DEPARTMENT CHAR(32);
}


PROCEDURE inner() {
    trace('Hello world');
}

TYPE PERSON FROM TABLE person;

FUNCTION process_employee(PERSON) : PERSON {
    output := input;

    IF input.ACTIVE {
        output.SALARY := input.SALARY * 1.1;
    } ELSE {
        output.SALARY := 0;
    }

    inner();

    exec sql declare c1 cursor for select person_id, department from employee where person_id = input.id;
    exec sql open c1;
        var employee from table employee;
        exec sql fetch c1 into :employee.person_id, :employee.department;

    exec sql close c1;
    
    WHILE output.SALARY < 50000 {
        output.SALARY := output.SALARY + 1000;
    }

    IF input.ACTIVE {
        output.SALARY := output.SALARY * 1.15;
    }
}

FUNCTION calculate_bonus(PERSON) : PERSON {
    output.SALARY := input.SALARY * 1.1;
}

PROCEDURE test_lists() {
    var numbers list(INTEGER);
    var employees list(EMPLOYEE);

    append(numbers, 10);
    append(numbers, 20);
    append(numbers, 30);

    trace("Length of numbers: " + len(numbers));

    var emp EMPLOYEE;
    emp.DEPARTMENT := "Engineering";
    append(employees, emp);

    emp.DEPARTMENT := "Sales";
    append(employees, emp);

    trace("Length of employees: " + len(employees));
}
