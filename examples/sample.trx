INCLUDE init.trx;
include json_test.trx;

CONSTANT PI 3.14159;
CONSTANT APP_NAME "TRX Interpreter";

TYPE ADDRESS {
    STREET CHAR(64);
    ZIP INTEGER;
}

TYPE PERSON {
    ID INTEGER;
    NAME CHAR(64);
    AGE INTEGER;
    ACTIVE BOOLEAN;
    SALARY DECIMAL(10,2);
}

TYPE EMPLOYEE {
    DEPARTMENT CHAR(32);
}

TYPE EMPLOYEES {
    employees list(EMPLOYEE);
}

PROCEDURE inner() {
    trace('Hello world');
}

FUNCTION process_employee(PERSON) : PERSON {
    output := input;

    var employees EMPLOYEES;

    IF input.ACTIVE THEN {
        output.SALARY := input.SALARY * 1.1;
    } ELSE {
        output.SALARY := 0;
    }

    inner();

    exec sql declare c1 cursor for select name from employee;
    exec sql open c1;
        var employee EMPLOYEE;
        exec sql fetch c1 into :employee;
    exec sql close c1;
    
    trace("Emnloyees: "+employees);

    WHILE output.SALARY < 50000 {
        output.SALARY := output.SALARY + 1000;
    }

    IF input.ACTIVE THEN {
        output.SALARY := output.SALARY * 1.15;
    }
}

FUNCTION calculate_bonus(PERSON) : PERSON {
    output.SALARY := input.SALARY * 1.1;
}

PROCEDURE test_lists() {
    var numbers list(INTEGER);
    var employees list(EMPLOYEE);

    append(numbers, 10);
    append(numbers, 20);
    append(numbers, 30);

    trace("Length of numbers: " + len(numbers));

    var emp EMPLOYEE;
    emp.DEPARTMENT := "Engineering";
    append(employees, emp);

    emp.DEPARTMENT := "Sales";
    append(employees, emp);

    trace("Length of employees: " + len(employees));
}
